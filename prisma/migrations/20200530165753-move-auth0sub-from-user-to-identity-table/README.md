# Migration `20200530165753-move-auth0sub-from-user-to-identity-table`

This migration has been generated by Carter Rabasa at 5/30/2020, 4:57:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Identity" (
"auth0Sub" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"deletedAt" timestamp(3)   ,"id" text  NOT NULL ,"updatedAt" timestamp(3)   ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "Identity.auth0Sub" ON "public"."Identity"("auth0Sub")

ALTER TABLE "public"."Identity" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200515152941-added-place-experiences-relationship..20200530165753-move-auth0sub-from-user-to-identity-table
--- datamodel.dml
+++ datamodel.dml
@@ -1,28 +1,39 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
 }
-     
+
+// Comment for User type
 model User {
-  id               String    @default(cuid()) @id
-  // used for Auth0 authentication
-  auth0Sub              String	@unique
-  email            String    @unique
-  productEmail     Boolean  @default(true)
-  promotionalEmail Boolean  @default(true)
-  profile          Profile?  @relation("UserProfile")
-  outboundConnections Connection[] @relation("outboundConnections")
-  inboundConnections  Connection[] @relation("inboundConnections")
-  createdAt        DateTime  @default(now())
-  updatedAt        DateTime?
-  deletedAt        DateTime?
+  id               		String    @default(cuid()) @id
+  email            		String    @unique
+  productEmail     		Boolean  @default(true)
+  promotionalEmail 		Boolean  @default(true)
+  profile          		Profile?  @relation("UserProfile")
+  outboundConnections 	Connection[] @relation("outboundConnections")
+  inboundConnections  	Connection[] @relation("inboundConnections")
+  identities			Identity[] @relation
+  createdAt        		DateTime  @default(now())
+  updatedAt        		DateTime?
+  deletedAt        		DateTime?
 }
+// 
+model Identity {
+  id               		String    @default(cuid()) @id
+  user              	User      @relation(fields: [userId], references: [id])
+  userId            	String
+  auth0Sub            	String    @unique
+  createdAt        		DateTime  @default(now())
+  updatedAt        		DateTime?
+  deletedAt        		DateTime?
+}
+
 model Connection {
   id          String    @default(cuid()) @id
   user        User      @relation("outboundConnections", fields: [userId], references: [id])
   userId      String
```


